<?php

if (!defined("__ONS_COMMON__"))
    include_once('ons_common.php');

/**
 * Generated by PHPUnit_SkeletonGenerator 1.2.0 on 2013-05-19 at 22:27:47.
 */
class dbRootTest extends PHPUnit_Framework_TestCase {

    public $loadDB;

    function testInitaliseDatabase() {
        LoadDatabase::testInitaliseDatabase();
        $this->assertTrue(true);
    }

    /**
     * @covers dbRoot::fromCache
     * @depends testInitaliseDatabase
     * 
     */
    public function testFromCache() {
        global $dbTables;
        $defs = dbRoot::fromCache("Defaults", 1);
        $this->assertGreaterThanOrEqual(1, count($dbTables["Defaults"]));
        $this->assertEquals("bhs", $defs->ShowName);
    }

    /**
     * @depends testFromCache
     */
    function testDefaultsCached() {
        $defs1 = dbRoot::fromCache("Defaults", 1);
        $defs2 = dbRoot::fromCache("Defaults", 1);

        $this->assertSame($defs1, $defs2);
    }
    
    /**
     * @depends testFromCache
     */
    function testAddToCache(){
        //Get DB Object
    }
    /**
     * @depends testFromCache
     */
    function testAddToCacheNoDupe(){
        //Get DB Object
    }
    
    /**
     * @covers dbRoot::clearCache
     * @depends testFromCache
     */
    public function testClearCache() {
        global $dbTables;
        dbRoot::clearCache("Defaults");
        $this->assertArrayNotHasKey("Defaults", $dbTables);
    }

    /**
     * @covers dbRoot::getTables
     * @todo   Implement testGetTables().
     */
    public function testGetTables() {
        $tables = dbRoot::getTables();
        //N.B. strtolower it so its consitent case.
        $tables = array_map('strtolower', $tables);
        //N.B. asort it so its alphabetical.        
        sort($tables);

        $this->assertEquals(
                array(
            'class',
            'defaultexhibitionclass',
            'defaultexhibitionclassprize',
            'defaultexhibitionexhibitor',
            'defaultexhibitionsection',
            'defaultexhibitiontrophyclass',
            'defaultprizefund',
            'defaults',
            'exhibition',
            'exhibitionclass',
            'exhibitionclassprize',
            'exhibitionexhibitor',
            'exhibitionsection',
            'exhibitiontrophyclass',
            'exhibitor',
            'prize',
            'section',
            'sponsorship',
            'trophy',
            'trophyresults')
                , $tables);
    }

    /**
     * @covers dbRoot::BackupDB
     * @depends testInitaliseDatabase
     */
    public function testBackupDB() {
        $temp=buildPath(__DIR__,"backup.xml");
        file_put_contents($temp, dbRoot::BackupDB());
        //$this->assertXmlFileEqualsXmlFile(buildPath(__DIR__,"..","testData","ShowManager","Summer2013.xml"),$temp);
    }
    
    
    
}
